# 项目详细设计文档

## 1. 项目概述

### 1.1 项目背景

在当前在线教育蓬勃发展的背景下，用户可能需要管理多个平台的课程账号和密码，频繁切换登录带来了不便。课程跳转系统旨在解决这一问题，提供统一的课程管理和自动登录功能，提升用户体验。

### 1.2 项目目标

- 提供统一的课程管理界面
- 实现第三方课程平台的自动登录
- 支持视频画中画播放
- 提供本地部署方案
- 确保系统安全性和稳定性

### 1.3 核心功能

1. **课程管理**：创建、编辑、删除课程
2. **自动登录**：跳转到第三方平台时自动填充用户名和密码
3. **视频播放**：支持画中画播放模式
4. **访问统计**：记录课程访问次数和时间
5. **安全加密**：使用AES-256-GCM加密课程凭证

## 2. 系统架构

### 2.1 整体架构

```
+----------------+       +----------------+       +----------------+
|    前端应用     |       |    后端服务     |       |    数据库       |
|  React + TypeScript |  |  Node.js + Express |  |    MySQL 8.0    |
|  Tailwind CSS   |       |  TypeScript    |       |                 |
+----------------+       +----------------+       +----------------+
         |                         |                         |
         |  HTTP/HTTPS             |  SQL/MySQL Protocol     |
         |------------------------>|------------------------>|  数据存储
         |                         |                         |
         |  JWT Authentication     |  AES-256-GCM Encryption |
         |------------------------>|------------------------>|  安全保障
         |                         |                         |
         |  RESTful API            |  Proxy Service          |
         |<------------------------|------------------------>|  业务逻辑
+----------------+       +----------------+       +----------------+
|   浏览器环境     |       |  服务器环境     |       |  数据库环境     |
+----------------+       +----------------+       +----------------+
```

### 2.2 技术栈

| 类别 | 技术 | 版本 | 用途 |
|------|------|------|------|
| **前端框架** | React | 18 | 构建用户界面 |
| **前端语言** | TypeScript | 5 | 类型安全的JavaScript |
| **前端构建工具** | Vite | 5 | 快速的前端构建工具 |
| **CSS框架** | Tailwind CSS | 3 | 实用优先的CSS框架 |
| **后端框架** | Express | 4 | 轻量级Web应用框架 |
| **后端语言** | TypeScript | 5 | 类型安全的Node.js开发 |
| **数据库** | MySQL | 8.0 | 关系型数据库 |
| **ORM** | 原生SQL | - | 数据库操作 |
| **认证** | JWT | - | 无状态认证 |
| **加密** | AES-256-GCM | - | 数据加密 |
| **HTTP客户端** | Axios | 1 | API请求 |
| **HTML解析** | Cheerio | 1 | 服务器端HTML解析 |

## 3. 前端设计

### 3.1 模块划分

| 模块 | 组件 | 功能 |
|------|------|------|
| **认证模块** | LoginRegister.tsx | 用户登录和注册 |
| **课程管理模块** | CourseDashboard.tsx | 课程列表展示 |
| | CourseCard.tsx | 单个课程卡片 |
| | AddCourseModal.tsx | 添加/编辑课程 |
| **视频模块** | VideoPlayer.tsx | 视频播放组件 |

### 3.2 组件层次结构

```
App.tsx
├── LoginRegister.tsx (认证界面)
└── CourseDashboard.tsx (课程管理界面)
    ├── CourseCard.tsx (课程卡片，多个)
    ├── AddCourseModal.tsx (添加/编辑课程弹窗)
    └── VideoPlayer.tsx (视频播放器)
```

### 3.3 状态管理

- **局部状态**：使用React useState和useEffect管理组件内部状态
- **全局状态**：使用Context API或Redux（预留扩展）
- **认证状态**：JWT存储在localStorage中

### 3.4 路由设计

| 路径 | 组件 | 功能 | 认证要求 |
|------|------|------|----------|
| / | LoginRegister | 登录/注册 | 不需要 |
| /dashboard | CourseDashboard | 课程列表 | 需要 |
| /video | VideoPlayer | 视频播放 | 需要 |

### 3.5 主要页面设计

#### 3.5.1 登录/注册页面

- 表单验证
- 密码可见性切换
- 错误提示
- 响应式设计

#### 3.5.2 课程管理页面

- 课程卡片网格布局
- 搜索和过滤功能
- 分页加载
- 添加/编辑/删除操作
- 访问统计展示

#### 3.5.3 课程跳转页面

- 步骤说明
- 自动填充提示
- 手动登录信息
- 跳转按钮

## 4. 后端设计

### 4.1 模块划分

| 模块 | 文件 | 功能 |
|------|------|------|
| **认证模块** | auth.controller.ts | 用户注册、登录、登出 |
| | auth.middleware.ts | JWT认证中间件 |
| **课程模块** | course.controller.ts | 课程CRUD操作 |
| | course.routes.ts | 课程路由 |
| **代理模块** | proxy.controller.ts | 课程跳转代理 |
| | proxy.routes.ts | 代理路由 |
| **服务模块** | encryption.service.ts | 数据加密服务 |
| **工具模块** | database.ts | 数据库连接 |

### 4.2 中间件设计

| 中间件 | 功能 | 应用范围 |
|--------|------|----------|
| **认证中间件** | JWT验证 | 所有需要认证的路由 |
| **错误处理中间件** | 统一错误处理 | 全局 |
| **CORS中间件** | 跨域资源共享 | 全局 |
| **日志中间件** | 请求日志记录 | 全局 |
| **限流中间件** | 防止恶意请求 | 登录、注册等敏感路由 |

### 4.3 核心业务流程

#### 4.3.1 用户注册流程

1. 用户提交注册信息
2. 后端验证邮箱和用户名唯一性
3. 生成随机盐值
4. 使用bcrypt加密密码
5. 生成UUID
6. 插入用户表
7. 返回注册成功信息

#### 4.3.2 课程创建流程

1. 用户提交课程信息
2. 后端验证权限
3. 加密课程凭证
4. 生成课程UUID
5. 插入课程表
6. 返回创建成功信息

#### 4.3.3 课程跳转流程

1. 用户点击课程卡片
2. 前端调用launchCourse API
3. 后端验证权限
4. 更新课程访问统计
5. 生成临时访问令牌
6. 返回跳转URL
7. 前端跳转到代理页面
8. 代理页面生成登录页面
9. 用户点击跳转按钮
10. 打开第三方登录页面
11. 自动填充用户名和密码
12. 用户完成登录和人机验证
13. 跳转到课程页面

## 5. 安全设计

### 5.1 数据加密

- **密码加密**：使用bcrypt算法，加盐存储
- **课程凭证加密**：使用AES-256-GCM算法
  - 32字节密钥
  - 12字节IV
  - 16字节认证标签
- **传输加密**：HTTPS协议（生产环境）

### 5.2 认证与授权

- **JWT认证**：无状态认证，有效期7天
- **会话管理**：Session Token用于浏览器会话
- **临时访问令牌**：一次性使用，有效期5分钟
- **权限控制**：用户只能访问自己的课程

### 5.3 输入验证

- **前端验证**：表单验证、类型检查
- **后端验证**：参数验证、SQL注入防护、XSS防护

### 5.4 安全日志

- 登录日志
- 课程访问日志
- 敏感操作日志
- 错误日志

## 6. 数据库设计

详细的数据库设计请参考《数据库设计文档》(DATABASE_DESIGN.md)。

## 7. 部署设计

### 7.1 开发环境部署

- 前端：`npm run dev`
- 后端：`npm run dev`
- 数据库：MySQL 8.0本地安装

### 7.2 生产环境部署

#### 7.2.1 前端部署

1. 构建生产版本：`npm run build`
2. 部署到Nginx或CDN
3. 配置HTTPS

#### 7.2.2 后端部署

1. 构建生产版本：`npm run build`
2. 使用PM2或Docker部署
3. 配置环境变量
4. 配置Nginx反向代理
5. 配置HTTPS

#### 7.2.3 数据库部署

1. MySQL 8.0部署
2. 配置主从复制
3. 定期备份
4. 配置防火墙

### 7.3 Docker部署

**Docker Compose配置示例**：

```yaml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
  
  backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - DB_USER=root
      - DB_PASSWORD=password
      - DB_NAME=course_jump_system
    depends_on:
      - mysql
  
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=course_jump_system
    volumes:
      - mysql-data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"

volumes:
  mysql-data:
```

## 8. 测试设计

### 8.1 测试策略

- **单元测试**：测试单个函数和组件
- **集成测试**：测试模块间的交互
- **API测试**：测试RESTful API
- **端到端测试**：测试完整业务流程
- **安全测试**：测试系统安全性
- **性能测试**：测试系统性能

### 8.2 测试工具

- **单元测试**：Jest, React Testing Library
- **API测试**：Postman, Supertest
- **端到端测试**：Cypress
- **性能测试**：Artillery
- **安全测试**：OWASP ZAP

### 8.3 测试用例示例

#### 8.3.1 用户注册测试

- 测试正常注册流程
- 测试邮箱格式错误
- 测试用户名已存在
- 测试密码强度不足

#### 8.3.2 课程跳转测试

- 测试正常跳转流程
- 测试权限验证
- 测试临时令牌有效性
- 测试自动填充功能

## 9. 性能优化

### 9.1 前端优化

- 代码分割和懒加载
- 组件缓存
- 图片优化
- 减少HTTP请求
- 使用CDN

### 9.2 后端优化

- 数据库连接池
- 合理索引设计
- 缓存热点数据
- 异步处理
- 负载均衡

### 9.3 数据库优化

- 分表分库（未来扩展）
- 读写分离
- 查询优化
- 定期清理过期数据

## 10. 未来扩展

### 10.1 功能扩展

- 支持更多第三方平台
- 课程分类和标签
- 学习进度跟踪
- 团队协作功能
- 移动端支持
- 浏览器扩展

### 10.2 技术扩展

- 微服务架构
- GraphQL API
- NoSQL支持
- 机器学习推荐
- 区块链认证

### 10.3 性能扩展

- 边缘计算
- 服务网格
- 自动伸缩
- 无服务器架构

## 11. 监控与维护

### 11.1 监控系统

- **应用监控**：PM2, New Relic
- **数据库监控**：MySQL Enterprise Monitor
- **服务器监控**：Prometheus + Grafana
- **日志监控**：ELK Stack

### 11.2 维护计划

- 定期更新依赖
- 修复安全漏洞
- 优化性能
- 改进用户体验
- 扩展功能

## 12. 文档管理

- **需求文档**：记录系统需求
- **设计文档**：记录系统设计
- **API文档**：记录API接口
- **部署文档**：记录部署流程
- **用户手册**：指导用户使用

## 13. 团队协作

- **版本控制**：Git
- **代码评审**：Pull Request
- **任务管理**：Jira, Trello
- **沟通工具**：Slack, Microsoft Teams

## 14. 风险评估

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 密码泄露 | 低 | 高 | 强加密、定期更换密钥 |
| 第三方平台登录失败 | 中 | 中 | 提供手动登录选项、完善错误提示 |
| 浏览器阻止弹窗 | 高 | 低 | 提供备用跳转方式、用户引导 |
| 数据库故障 | 低 | 高 | 定期备份、主从复制、灾难恢复计划 |
| 性能瓶颈 | 中 | 中 | 性能监控、优化、扩展架构 |

## 15. 结论

课程跳转系统采用现代技术栈，具有良好的扩展性和安全性。通过统一的课程管理和自动登录功能，为用户提供了便捷的在线学习体验。系统设计考虑了性能、安全和可维护性，能够满足当前需求并支持未来扩展。

## 16. 附录

### 16.1 参考文档

- [React官方文档](https://react.dev/)
- [Express官方文档](https://expressjs.com/)
- [TypeScript官方文档](https://www.typescriptlang.org/)
- [MySQL 8.0参考手册](https://dev.mysql.com/doc/refman/8.0/en/)

### 16.2 术语表

| 术语 | 解释 |
|------|------|
| JWT | JSON Web Token，用于认证的令牌 |
| AES | Advanced Encryption Standard，高级加密标准 |
| GCM | Galois/Counter Mode，一种加密模式 |
| bcrypt | 一种密码哈希算法 |
| UUID | Universally Unique Identifier，通用唯一标识符 |
| RESTful API | 符合REST架构风格的API |
| CORS | Cross-Origin Resource Sharing，跨域资源共享 |
| ORM | Object-Relational Mapping，对象关系映射 |
